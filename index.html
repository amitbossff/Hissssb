<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hisab Fund</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#f1f3f6;
}

/* TOP BAR */
.top-bar{
  position:sticky;
  top:0;
  background:#fff;
  padding:14px;
  box-shadow:0 2px 8px rgba(0,0,0,.12);
  z-index:10;
}
.top-flex{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.total-fund{
  font-size:18px;
  font-weight:600;
  color:#0a9b4f;
}
.top-actions{
  display:flex;
  gap:8px;
}
.reset-btn{
  background:#ff3b3b;
  color:white;
  padding:8px 14px;
  border:none;
  border-radius:18px;
}
.logout-btn{
  background:#222;
  color:white;
  padding:8px 14px;
  border:none;
  border-radius:18px;
}

/* CARDS */
.container{
  padding:12px;
  padding-bottom:90px;
}
.card{
  background:#fff;
  padding:14px;
  margin-bottom:12px;
  border-radius:16px;
  box-shadow:0 6px 14px rgba(0,0,0,.08);
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.name{
  font-size:17px;
  font-weight:600;
}
.total{
  font-size:18px;
  color:#0a9b4f;
}
.add-btn{
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  background:#007bff;
  color:white;
  font-size:26px;
}
.history{
  font-size:13px;
  color:#666;
  margin-top:6px;
}

/* INPUT */
.input-box{
  display:none;
  margin-top:8px;
}
.input-row{
  display:flex;
  gap:8px;
}
.input-row input{
  flex:1;
  padding:10px;
  font-size:16px;
  border-radius:10px;
  border:1px solid #ccc;
}
.check-btn{
  background:#0a9b4f;
  color:white;
  border:none;
  border-radius:10px;
  font-size:18px;
  padding:0 14px;
}

/* BOTTOM BAR */
.bottom-bar{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#fff;
  box-shadow:0 -2px 8px rgba(0,0,0,.12);
  padding:10px;
}
.bottom-bar button{
  width:100%;
  background:#222;
  color:white;
  font-size:16px;
  padding:12px;
  border:none;
  border-radius:16px;
}

/* POPUP */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;
}
.popup-box{
  background:#fff;
  width:85%;
  padding:16px;
  border-radius:16px;
}
.popup-list{
  font-size:14px;
  margin-top:10px;
  line-height:1.6;
}
.popup-actions{
  display:flex;
  gap:10px;
  margin-top:14px;
}
.popup-actions button{
  flex:1;
  padding:10px;
  border:none;
  border-radius:12px;
}
.btn-primary{background:#007bff;color:white}
.btn-danger{background:#ff3b3b;color:white}
.btn-grey{background:#ccc}

/* TOAST */
.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#222;
  color:#fff;
  padding:10px 18px;
  border-radius:20px;
  opacity:0;
  transition:.3s;
  z-index:30;
}
.toast.show{opacity:1}
</style>
</head>

<body>

<script>
const currentUser = localStorage.getItem("hisabUser");
if(!currentUser){
  location.href="login.html";
}
</script>

<!-- TOP -->
<div class="top-bar">
  <div class="top-flex">
    <div class="total-fund">
      ₹ <span id="grandTotal">0</span> | User: <b id="userName"></b>
    </div>
    <div class="top-actions">
      <button class="logout-btn" onclick="logout()">LOGOUT</button>
      <button class="reset-btn" onclick="openResetPopup()">RESET</button>
    </div>
  </div>
</div>

<div class="container" id="users"></div>

<!-- BOTTOM -->
<div class="bottom-bar">
  <button onclick="showAll()">ALL SUMMARY</button>
</div>

<!-- SUMMARY POPUP -->
<div class="popup" id="summaryPopup">
  <div class="popup-box">
    <h3>All Summary</h3>
    <div class="popup-list" id="popupList"></div>
    <div class="popup-actions">
      <button class="btn-primary" onclick="copySummary()">COPY</button>
      <button class="btn-grey" onclick="closeSummary()">Close</button>
    </div>
  </div>
</div>

<!-- RESET POPUP -->
<div class="popup" id="resetPopup">
  <div class="popup-box">
    <h3>Confirm Reset</h3>
    <p>Saara data permanently delete ho jayega.</p>
    <div class="popup-actions">
      <button class="btn-danger" onclick="confirmReset()">RESET</button>
      <button class="btn-grey" onclick="closeReset()">Cancel</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore, doc, setDoc, updateDoc,
  onSnapshot, arrayUnion, increment, deleteDoc
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

document.getElementById("userName").innerText = currentUser;

const firebaseConfig={
  apiKey:"AIzaSyDhTmo1tkJ_4ByGwMxysi4AXtThhfQbt0c",
  authDomain:"amitbhai-298d5.firebaseapp.com",
  projectId:"amitbhai-298d5",
  storageBucket:"amitbhai-298d5.firebasestorage.app",
  messagingSenderId:"798114903278",
  appId:"1:798114903278:web:f9b1efc6ac7aa7b48a6fff"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const names=["Amit","Quality","Akashi","Leon","Aakash","Ankur","Raj"];
const usersDiv=document.getElementById("users");
let totals={};

names.forEach(name=>{
  totals[name]=0;
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`
    <div class="header">
      <div>
        <div class="name">${name}</div>
        <div class="total">₹ <span id="total-${name}">0</span></div>
      </div>
      <button class="add-btn" id="plus-${name}" onclick="showInput('${name}')">+</button>
    </div>

    <div class="input-box" id="input-${name}">
      <div class="input-row">
        <input type="number" placeholder="Amount">
        <button class="check-btn" onclick="saveByButton('${name}')">✅</button>
      </div>
    </div>

    <div class="history" id="history-${name}"></div>
  `;
  usersDiv.appendChild(div);

  onSnapshot(
    doc(db,"users",currentUser,"data",name),
    snap=>{
      if(!snap.exists())return;
      const d=snap.data();
      totals[name]=d.total||0;
      document.getElementById("total-"+name).innerText=d.total||0;
      document.getElementById("history-"+name).innerText=(d.history||[]).join(" + ");
      updateGrandTotal();
    }
  );
});

window.showInput=name=>{
  document.getElementById("plus-"+name).style.display="none";
  const box=document.getElementById("input-"+name);
  box.style.display="block";
  box.querySelector("input").focus();
};

window.saveByButton=async(name)=>{
  const box=document.getElementById("input-"+name);
  const input=box.querySelector("input");
  const val=parseFloat(input.value);
  if(isNaN(val))return;

  const ref=doc(db,"users",currentUser,"data",name);
  try{
    await updateDoc(ref,{ total:increment(val), history:arrayUnion(val) });
  }catch{
    await setDoc(ref,{ total:val, history:[val] });
  }

  input.value="";
  box.style.display="none";
  document.getElementById("plus-"+name).style.display="block";
};

function updateGrandTotal(){
  document.getElementById("grandTotal").innerText=
    Object.values(totals).reduce((a,b)=>a+b,0);
}

/* RESET */
window.openResetPopup=()=>document.getElementById("resetPopup").style.display="flex";
window.closeReset=()=>document.getElementById("resetPopup").style.display="none";
window.confirmReset=async()=>{
  document.getElementById("resetPopup").style.display="none";
  for(const n of names){
    await deleteDoc(doc(db,"users",currentUser,"data",n));
  }
  location.reload();
};

/* SUMMARY */
window.showAll=()=>{
  let html="";
  names.forEach(n=>html+=`${n} – ₹ ${totals[n]||0}<br>`);
  document.getElementById("popupList").innerHTML=html;
  document.getElementById("summaryPopup").style.display="flex";
};
window.closeSummary=()=>document.getElementById("summaryPopup").style.display="none";
window.copySummary=()=>{
  navigator.clipboard.writeText(
    names.map(n=>`${n} - ${totals[n]||0}`).join("\n")
  );
  showToast("Summary copied");
};

function showToast(msg){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}

/* LOGOUT */
window.logout=()=>{
  localStorage.removeItem("hisabUser");
  location.href="login.html";
};
</script>

</body>
  </html>
